---
title: "HW 02"
author: "Seldon David Kyle"
format: 
  html:
    embed-resources: true
toc: true
---

```{r}
#| label: load-pkgs
#| message: false
#| echo: false

if (!require("pacman")) 
  install.packages("pacman, ggridges")

pacman::p_load(tidyverse,
               ggridges,
               viridis,
               dsbox,
               fs,
               janitor,
               scales)

```

## 1 - A new day, a new plot, a new geom

```{r}

# filter and reorder
edibnb_clean <- dsbox::edibnb |>
  filter(!is.na(review_scores_rating), !is.na(neighbourhood)) |>
  mutate(
    neighbourhood_ordered = fct_reorder(
      neighbourhood,
      review_scores_rating,
      .fun  = median
    )
  )

# plot
ggplot(edibnb_clean, aes(
    x = review_scores_rating,
    y = neighbourhood_ordered
  )) +
  geom_density_ridges(
    fill  = "steelblue",
    color = "white",
    alpha = 0.7,
    scale = 1.3
  ) +
  labs(
    title   = "Airbnb Review Scores by Edinburgh Neighborhood",
    x       = "Review Score",
    y       = "Neighborhood (highest median at top)",
    caption = "Source: edibnb from the dsbox library"
  ) +
  theme_ridges(grid = TRUE) +
  theme(
    plot.title      = element_text(hjust = 0),  # left align
    legend.position = "none"
  )



```

Most neighborhoods examined show generally high reviews. The neighborhoods with the highest medians display tighter clusters communicating consistently high guest satisfaction. The lower scored neighborhoods have flatter more spread plots meaning a wider variety of satisfaction. Outliers on the low end of the scale force a lot of white space.

## 2 - Foreign Connected PACs

### Load Data

```{r}
# get a list of files with "Foreign Connected PAC" in their names
list_of_files <- dir_ls(path = "data", regexp = "Foreign Connected PAC")

# read all files and row bind them
# keeping track of the file name in a new column called year
pac <- read_csv(list_of_files, id = "year")

```

### Clean Data

```{r}
pac_year <- pac |>
  # clean headers
  clean_names() |>
  # strip chars before year range and .csv
  mutate(year = basename(year) |> str_remove("\\.csv$")) |>
  # split into year_start and year on the "-" char
  separate(
    col     = year,
    into    = c("year_start", "year"),
    sep     = "-",
    convert = TRUE
  ) |>
  # drop the year_start column
  select(-year_start) |>
  separate(
    col     = country_of_origin_parent_company,
    into    = c("country_of_origin", "parent_company"),
    sep     = "/",
    convert = TRUE
  ) |>
  # now drop negatives. I don't know what a negative would mean in this context
 filter(
    !str_detect(dems, "-"),
    !str_detect(repubs, "-")
  ) |>
 # turn dems and repubs inot dbls
  mutate(
    dems   = parse_number(dems),
    repubs = parse_number(repubs)
  ) |>   
  # drop the total column
  select(-total)

```

### Pivoting data

```{r}
pac_long <- pac_year |>
  pivot_longer(
    cols      = c(dems, repubs),
    names_to  = "party",
    values_to = "amount"
  ) |>
  mutate(
    party = recode(party,
                   dems   = "Democrat",
                   repubs = "Republican")
  )


```

### Summarize for the UK

```{r}
uk_summary <- pac_long |>
  filter(country_of_origin == "UK") |>
  group_by(year, party) |>
  summarise(
    total_amount = sum(amount, na.rm = TRUE),
    .groups      = "drop"
  ) |>
  arrange(year, party)

```

### Recreate Plot

```{r}
max_year     <- max(uk_summary$year)
lower_bound  <- 1e6 * 0.8  

ggplot(uk_summary, aes(x = year, y = total_amount, color = party)) +
  geom_line(size = 1.2) +
  scale_color_manual(values = c(Democrat = "blue", Republican = "red")) +
  scale_x_continuous(
    limits = c(2000, max_year),
    breaks = seq(2000, max_year, by = 5)
  ) +
  scale_y_continuous(
    labels = dollar_format(scale = 1e-6, suffix = "M"),
    limits = c(lower_bound, max(uk_summary$total_amount)),
    expand = c(0, 0)
  ) +
  labs(
    # single‐line title, no explicit newline
    title   = "Contributions to US Political Parties from UK-Connected PACs",
    x       = "Year",
    y       = "Total amount",
    caption = "Source: OpenSecrets.org"
  ) +
  coord_cartesian(clip = "off") +
  theme_minimal() +
  theme(
    plot.title.position = "plot",
    plot.title          = element_text(
                            hjust = 0.3,
                            size  = 14,
                            margin = margin(b = 10)  # a bit of space below
                          ),
    axis.title.x.position = "plot",
    axis.title.x          = element_text(hjust = 0),
    axis.title.y.position = "plot",
    axis.title.y          = element_text(
                            angle = 90,
                            vjust = 1,
                            hjust = 0
                          ),
    legend.position     = c(0.85, 0.15),
    legend.background   = element_rect(fill = alpha("white", 0.6), color = NA),
    legend.title        = element_blank(),
    plot.margin         = margin(t = 5, r = 5, b = 5, l = 40)
  )



```

### Recreate Plot For Canada

```{r}
ca_summary <- pac_long |>
  filter(country_of_origin == "Canada") |>
  group_by(year, party) |>
  summarise(
    total_amount = sum(amount, na.rm = TRUE),
    .groups      = "drop"
  ) |>
  arrange(year, party)

ca_summary |>
  glimpse()

```

```{r}
min_amt    <- min(ca_summary$total_amount)
max_year   <- max(ca_summary$year)
max_amt    <- max(ca_summary$total_amount)

lower_bound <- min_amt * 0.95  # 5% below the smallest value

ggplot(ca_summary, aes(year, total_amount, color = party)) +
  geom_line(size = 1.2) +
  scale_color_manual(values = c(Democrat = "blue", Republican = "red")) +
  scale_x_continuous(
    limits = c(2000, max_year),
    breaks = seq(2000, max_year, by = 5)
  ) +
  scale_y_continuous(
    labels = dollar_format(scale = 1e-6, suffix = "M"),
    limits = c(lower_bound, max_amt),
    expand = c(0, 0)
  ) +
  labs(
    title   = "Contributions to US Political Parties from Canada-Connected PACs",
    x       = "Year",
    y       = "Total amount",
    caption = "Source: OpenSecrets.org"
  ) +
  coord_cartesian(clip = "off") +
  theme_minimal() +
  theme(
    plot.title.position    = "plot",
    plot.title             = element_text(hjust = 0, size = 12),
    axis.title.x.position  = "plot",
    axis.title.x           = element_text(hjust = 0),
    axis.title.y.position  = "plot",
    axis.title.y           = element_text(angle = 90, vjust = 1, hjust = 0),
    legend.position        = c(0.85, 0.15),
    legend.background      = element_rect(fill = alpha("white", 0.6), color = NA),
    legend.title           = element_blank(),
    plot.margin            = margin(t = 5, r = 5, b = 5, l = 40)
  )
```

#### Interpretation 

Canada-connected PACs ramp up around every federal election, briefly lean Democratic in 2008–2010, then shift to a strong Republican advantage through the 2010s. Overall, there has been a sharp increase in overall spending by both parties.

## 3 - Median housing prices in the US

### Load Data

```{r}
median_housing <- read.csv("data/median-housing.csv")
recessions <- read_csv("data/recessions.csv")


```

### Rename and Clean Data

```{r}
median_housing2 <- median_housing |>
  # rename columns
  rename(
    date  = DATE,
    price = MSPUS
  ) |>
  # parse the date strings into actual Date objects
  mutate(
    date = ymd(date)
  )

# verify
median_housing2 |> glimpse()
```

### Create Plot

```{r}
# compute bounds
max_date  <- max(median_housing2$date)
max_price <- max(median_housing2$price, na.rm = TRUE)

ggplot(median_housing2, aes(x = date, y = price)) +
  geom_line(color = "steelblue", size = 1) +
  scale_x_date(
    breaks = seq(as.Date("1965-01-01"), max_date, by = "5 years"),
    date_labels = "%Y",
    expand      = c(0, 0)
  ) +
  scale_y_continuous(
    labels = comma,
    breaks = seq(0, max_price, by = 40000),
    limits = c(0, max_price),
    expand = c(0, 0)
  ) +
  labs(
    title    = "Median sales price of houses sold in the United States",
    subtitle = "Not seasonally adjusted",
    x        = NULL,
    y        = "Dollars",
    caption  = "Sources: Census; HUD"
  ) +
  theme_minimal() +
  theme(
    # remove vertical grid lines
    panel.grid.major.x     = element_blank(),
    panel.grid.minor.x     = element_blank(),
    # keep horizontal lines
    panel.grid.major.y     = element_line(color = "grey80"),
    panel.grid.minor.y     = element_blank(),
    # title and subtitle
    plot.title.position    = "plot",
    plot.title             = element_text(hjust = 0, size = 14),
    plot.subtitle          = element_text(hjust = 0, size = 10, margin = margin(b = 8), face = "bold"),
    # center y‐label and make bold
    axis.title.y.position  = "plot",
    axis.title.y           = element_text(angle = 90, hjust = 0.5, vjust = 0.5, face = "bold"),
    # caption bold and right‐aligned
    plot.caption           = element_text(hjust = 1, face = "bold"),
    
    plot.margin            = margin(t = 5, r = 5, b = 5, l = 5)
  )




```

###  

## 4 - Expect More. Plot More.

## 5 - Mirror, mirror on the wall, who’s the ugliest of them all?
